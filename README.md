# 文件夹链接与空间分析工具

这是一个使用 Python 和 Tkinter 构建的图形化工具，旨在帮助用户管理文件夹，特别是将位于系统盘（如 `AppData`）中的应用数据文件夹移动到其他位置，并创建符号链接（Symbolic Link）以确保程序正常运行。同时，它还提供了简单的磁盘空间分析功能。

## 主要功能

- **创建符号链接**:
  - 将指定的源文件夹完整地移动到另一个目标位置。
  - 在原始位置创建一个指向新位置的符号链接，对操作系统和应用程序透明。
  - 采用安全的操作流程（复制 -> 重命名 -> 创建链接 -> 删除备份），并在关键步骤失败时尝试自动回滚。
- **还原符号链接**:
  - 安全地删除符号链接。
  - 将之前移动的数据文件夹恢复到原始位置。
- **空间分析**:
  - 扫描 Windows 系统中的 `AppData` 目录 (`Local`, `LocalLow`, `Roaming`)。
  - 按文件夹大小降序显示，帮助用户快速找到占用空间较大的应用程序数据。
- **图形化界面**:
  - 提供直观的图形用户界面（GUI），支持拖放操作添加文件夹。
  - 所有操作和结果都会实时显示在日志窗口中。
- **安全保护**:
  - 内置系统关键目录保护列表（如 `C:\Windows`, `/etc` 等），防止用户对它们进行危险操作。
  - 允许用户添加自定义的保护路径。
- **配置与日志**:
  - 自动保存目标目录等配置到 `linker_config.json`。
  - 详细记录所有已成功创建的链接信息到 `linker_log.json`，方便追踪和还原。

## 如何使用

### 直接运行

直接下载可执行文件 (`linker_tool.exe`)，双击运行即可。

**注意**: 在 Windows 系统上，创建符号链接通常需要**管理员权限**。请右键点击程序并选择“以管理员身份运行”。

### 从源码运行

1.  **安装依赖**:
    本工具依赖一个用于拖放功能的第三方库。请通过 pip 安装它：
    ```shell
    pip install tkinterdnd2-universal
    ```

2.  **运行脚本**:
    使用 Python 解释器运行主脚本：
    ```shell
    python linker_tool.py
    ```
    同样，在 Windows 上建议使用管理员权限的终端来运行此脚本。

## 界面说明

1.  **配置区**:
    - **目标基目录**: 这是所有文件夹将被移动到的根目录。例如，如果你选择 `D:\Data`，那么 `C:\Users\YourUser\AppData\Local\SomeApp` 将被移动到 `D:\Data\SomeApp`。
    - **更改...**: 点击可选择新的目标基目录。
    - **编辑保护列表...**: 查看和添加自定义的受保护文件夹，防止误操作。

2.  **操作模式**:
    - **创建链接**: 选择此模式以移动文件夹并创建链接。
    - **还原链接**: 选择此模式以还原已创建的链接。

3.  **待处理文件夹列表**:
    - **添加...**: 手动选择要处理的文件夹。
    - **移除选中**: 从列表中移除选中的项。
    - **拖放**: 你可以直接从文件浏览器将文件夹拖到此列表框中。

4.  **执行按钮**:
    - 点击此按钮对列表中的所有项目执行批量操作。

5.  **文件夹空间分析 (AppData) Tab**:
    - **开始扫描**: 点击开始分析 `AppData` 目录。
    - **添加选中到待处理**: 在扫描结果中选中一个或多个文件夹，点击此按钮可将它们快速添加到上面的“待处理列表”中（仅在“创建链接”模式下有效）。

6.  **日志输出 Tab**:
    - 显示程序运行过程中的所有详细信息、成功、警告和错误。

## 配置文件

-   **`linker_config.json`**: 保存你的设置。
    -   `target_base_dir`: 目标基目录的路径。
    -   `custom_protected_paths`: 用户自定义的保护路径列表。
-   **`linker_log.json`**: 记录所有已创建的链接。此文件是**还原操作**的重要依据，请勿手动修改或删除，除非你清楚自己在做什么。

## 如何打包

本项目使用 [PyInstaller](https://pyinstaller.org/) 进行打包。

1.  安装 PyInstaller:
    ```shell
    pip install pyinstaller
    ```
2.  执行打包命令:
    ```shell
    pyinstaller linker_tool.spec
    ```
    或者直接对主文件打包：
    ```shell
    pyinstaller linker_tool.py --onefile --windowed --name linker_tool
    ```
